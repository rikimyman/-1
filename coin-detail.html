<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cryptocurrency Details</title>
  <link rel="stylesheet" href="coin-detail.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Include Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- TradingView Widget Script -->
  <script src="https://s3.tradingview.com/tv.js"></script>
</head>
<body>
  <!-- Theme toggle button with improved accessibility -->
  <button id="theme-toggle" aria-label="Toggle dark/light mode"></button>
  
  <!-- Loading indicator -->
  <div id="detail-loading"></div>
  
  <div class="container">
    <!-- Header with back button and coin info -->
    <div class="detail-header">
      <!-- Updated back button with direct link to riki.html -->
      <a href="riki.html" id="back-button" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
        </svg>
        Back to Market
      </a>
      
      <!-- Coin header with logo, name, and price (separated from stats) -->
      <div class="top-info-bar">
        <!-- Will be filled by JavaScript -->
      </div>
      
      <!-- Key Statistics Overview Card - NEW -->
      <div id="stats-overview-card" class="stats-overview-card">
        <!-- Will be filled dynamically with stats -->
      </div>
    </div>
    
    <!-- Main content area with chart on left and metrics on right -->
    <div class="main-content">
      <!-- Left side - Chart area with toggle between line and TradingView -->
      <div class="chart-section">
        <!-- Chart header with title and toggle -->
        <div class="chart-header">
          <div class="chart-title-area">
            <h2 class="chart-title">Price Chart</h2>
          </div>
          <div id="chart-type-toggle">
            <!-- Will be filled by JavaScript -->
          </div>
        </div>
        
        <!-- Time period selection -->
        <div class="time-controls">
          <button class="time-button" data-timeframe="1H">1H</button>
          <button class="time-button active" data-timeframe="24H">24H</button>
          <button class="time-button" data-timeframe="7D">7D</button>
          <button class="time-button" data-timeframe="1M">1M</button>
          <button class="time-button" data-timeframe="3M">3M</button>
          <button class="time-button" data-timeframe="1Y">1Y</button>
          <button class="time-button" data-timeframe="ALL">ALL</button>
        </div>
        
        <div class="chart-card">
          <!-- Both chart types in same container -->
          <canvas id="price-chart"></canvas>
          <div id="tradingview-chart"></div>
        </div>
        
        <div class="volume-chart-card">
          <div class="volume-chart-container">
            <canvas id="volume-chart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Right side - Additional metrics and info -->
      <div class="metrics-section">
        <!-- Price statistics with improved professional layout -->
        <div class="metrics-card">
          <h3>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
            </svg>
            Price Statistics
          </h3>
          <div id="price-stats-container">
            <!-- Will be filled by JavaScript with enhanced high/low range visualization -->
          </div>
        </div>
        
        <!-- About section -->
        <div class="metrics-card">
          <h3>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd"/>
            </svg>
            About
          </h3>
          <div id="coin-description" class="description-content">
            <!-- Will be filled by JavaScript -->
            Loading coin information...
          </div>
        </div>
        
        <!-- News section -->
        <div class="news-section">
          <div class="news-header">
            <h3 class="news-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M0 2.5A1.5 1.5 0 0 1 1.5 1h11A1.5 1.5 0 0 1 14 2.5v10.528c0 .3-.05.654-.238.972h.738a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 1 1 0v9a1.5 1.5 0 0 1-1.5 1.5H1.497A1.497 1.497 0 0 1 0 13.5v-11zM12 14c.37 0 .654-.211.853-.441.092-.106.147-.279.147-.531V2.5a.5.5 0 0 0-.5-.5h-11a.5.5 0 0 0-.5.5v11c0 .278.223.5.497.5H12z"/>
                <path d="M2 3h10v2H2V3zm0 3h4v3H2V6zm0 4h4v1H2v-1zm0 2h4v1H2v-1zm5-6h2v1H7V6zm3 0h2v1h-2V6zM7 8h2v1H7V8zm3 0h2v1h-2V8zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1zm-3 2h2v1H7v-1zm3 0h2v1h-2v-1z"/>
              </svg>
              Latest News
            </h3>
          </div>
          
          <div id="news-items" class="news-items">
            <!-- Will be filled by JavaScript -->
            <div class="news-item-placeholder">Loading news...</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Custom tooltip for chart interaction -->
    <div id="chart-tooltip">
      <div class="tooltip-date"></div>
      <div class="tooltip-price"></div>
    </div>
  </div>
  
  <script src="coin-detail.js"></script>
  <script src="theme-sync.js"></script>
  
  <!-- Add news functionality -->
  <script>
    // Fetch news related to the coin
    async function fetchCryptoNews(coinName) {
      try {
        const newsContainer = document.getElementById('news-items');
        if (!newsContainer) return;
        
        // Use CryptoCompare News API
        const response = await fetch(`https://min-api.cryptocompare.com/data/v2/news/?categories=${coinName.toLowerCase()}&excludeCategories=Sponsored`);
        if (!response.ok) throw new Error('Failed to fetch news');
        
        const data = await response.json();
        const news = data.Data?.slice(0, 5) || [];
        
        if (news.length === 0) {
          newsContainer.innerHTML = '<div class="no-news">No recent news found for this cryptocurrency.</div>';
          return;
        }
        
        newsContainer.innerHTML = news.map(item => `
          <div class="news-item">
            <div class="news-image">
              <img src="${item.imageurl}" alt="${item.source_info.name}" onerror="this.src='https://via.placeholder.com/80x80?text=News'">
            </div>
            <div class="news-content">
              <div class="news-source">${item.source_info.name}</div>
              <h4 class="news-headline">${item.title}</h4>
              <div class="news-snippet">${item.body.substring(0, 100)}...</div>
              <div class="news-date">${new Date(item.published_on * 1000).toLocaleDateString()}</div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Error fetching news:', error);
        const newsContainer = document.getElementById('news-items');
        if (newsContainer) {
          newsContainer.innerHTML = '<div class="error-message">Failed to load news. Please try again later.</div>';
        }
      }
    }
    
    // Add event listener to fetch news after coin data is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Add a listener to fetch news when coin data is ready
      window.addEventListener('coinDataReady', function(e) {
        if (e.detail && e.detail.name) {
          fetchCryptoNews(e.detail.name);
        }
      });
    });
  </script>
</body>
</html>
