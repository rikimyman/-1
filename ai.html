<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zenus - Crypto AI Assistant</title>
    <!-- Add these scripts to the head section of your HTML -->
    <script src="coins-data.js"></script>
    <script src="ai-answer.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        :root {
            /* Light mode (default) */
            --primary-color: #000000;
            --primary-hover: #2B6CB0;
            --bg-color: #FFFFFF;
            --sidebar-bg: #F8FAFC;
            --text-color: #000000;
            --text-light: #636c78;
            --border-color: #E2E8F0;
            --border-hover: #CBD5E0;
            --message-bot-bg: #F8FAFC;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --card-radius: 16px;
            --transition: all 0.2s ease;
        }
        
        /* Dark mode variables */
        body.dark-mode {
            --primary-color: #FFFFFF;  /* White instead of blue */
            --primary-hover: #E2E8F0;  /* Light gray instead of light blue */
            --bg-color: #000000;       /* Black instead of dark blue */
            --sidebar-bg: #111111;     /* Dark gray instead of slate */
            --text-color: #FFFFFF;     /* White text */
            --text-light: #CCCCCC;     /* Light gray text */
            --border-color: #333333;   /* Dark gray borders */
            --border-hover: #555555;   /* Medium gray border hover */
            --message-bot-bg: #111111; /* Dark gray message background */
            --card-shadow: 0 4px 12px rgba(255, 255, 255, 0.1); /* White glow instead of black */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--text-color);
            display: flex;
            height: 100vh;
            background-color: var(--bg-color);
        }

        /* Sidebar styles */
        .sidebar {
            width: 240px;
            background-color: var(--sidebar-bg);
            color: var(--primary-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            border-right: 1px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.03);
            transition: var(--transition);
            z-index: 10;
        }

        
  /* Add styles for the sidebar toggle button for larger screens */
  .sidebar-toggle-large {
    display: none; /* Hidden by default */
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 15;
    background-color: transparent !important; /* Force transparent background */
    border: none !important; /* Force no border */
    border-radius: 0; /* Remove border radius */
    width: 40px;
    height: 40px;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: none !important; /* Force no shadow */
    align-items: center;
    justify-content: center;
}
/* Make sidebar toggle icon match theme color */
.sidebar-toggle-large svg {
    stroke: var(--text-color); /* Use the text color variable which changes with theme */
    stroke-width: 2.5; /* Make the stroke a bit bolder for better visibility */
}

/* Hover effect for clickability feedback */
.sidebar-toggle-large:hover {
    transform: translateY(-2px);
    background-color: transparent !important; /* Keep background transparent on hover */
}

.sidebar-toggle-large:hover {
    background-color: rgba(0, 0, 0, 0.05);
    transform: translateY(-2px);
}

.dark-mode .sidebar-toggle-large:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
/* Add transition to the sidebar-toggle-large */
.sidebar-toggle-large {
    transition: left 0.3s ease; /* Match the sidebar transition */
}

/* Create a shifted position for when sidebar is shown */
body:not(.sidebar-hidden) .sidebar-toggle-large {
    left: 260px; /* 240px width of sidebar + 20px original left margin */
}

/* Show sidebar toggle on larger screens */
@media (min-width: 769px) {
    .sidebar-toggle-large {
        display: flex;
    }
    
    /* Hide the mobile menu toggle button on larger screens */
    .menu-toggle {
        display: none;
    }
    
    /* Add class for when sidebar is hidden */
    body.sidebar-hidden .sidebar {
        margin-left: -240px; /* Hide the sidebar by pushing it off-screen */
    }
    
    body.sidebar-hidden .chat-container {
        margin-left: 0; /* Remove the margin when sidebar is hidden */
    }
}     
/* Add this style to move the history items down - only on mobile */
.history {
    flex: 1;
    
    overflow-y: auto;
    padding: 20px 20px 20px; /* Original padding */
    margin-top: 0; /* Original margin */
}

/* Original history heading styling */
.history-heading {
    font-size: 14px;
    color: var(--text-light);
    margin: 12px 0 12px 8px; /* Original margin */
    font-weight: 500;
    letter-spacing: 0.5px;
}

/* Original history item styling */
.history-item {
    padding: 14px 18px;
    margin-bottom: 8px; /* Original margin */
    border-radius: var(--card-radius);
    cursor: pointer;
    font-size: 14px;
    color: var (var(--primary-color));
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: var(--transition);
    display: flex;
    align-items: center;
    border: 1px solid transparent;
    background-color: transparent;
}

/* Mobile responsive design - Apply the increased spacing only on mobile */
/* Mobile responsive design - Apply the increased spacing only on mobile */
@media (max-width: 768px) {
    /* Move the history items down on mobile to create better spacing */
    .history {
        padding: 30px 20px 20px; /* Increase top padding */
        margin-top: 90px; /* Increase top margin to move items further down */
    }

    /* More space below the heading on mobile */
    .history-heading {
        margin: 12px 0 25px 8px; /* Increase bottom margin for better separation */
        font-size: 16px; /* Slightly larger font size */
        font-weight: 600; /* Make it more prominent */
        letter-spacing: 0.8px; /* Increase letter spacing for better readability */
    }

    /* Add spacing between history items on mobile */
    .history-item {
        margin-bottom: 20px; /* Increase spacing between items */
        padding: 16px 20px; /* Larger padding for easier touch targets */
        border-radius: 18px; /* Slightly rounder corners */
        font-size: 15px; /* Slightly larger text */
        background-color: rgba(255, 255, 255, 0.5); /* Subtle background for better visibility */
        border: 1px solid var(--border-color); /* Add a subtle border */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03); /* Subtle shadow for depth */
    }
    
    /* Style the conversation icon */
    .history-item svg {
        width: 20px; /* Larger icon */
        height: 20px;
        margin-right: 14px; /* More space between icon and text */
    }
    
    /* Animate history item hover state */
    .history-item:hover, .history-item:active {
        transform: translateX(4px);
        background-color: var(--bg-color);
        border-color: var(--border-hover);
    }
    
    /* Style the New Chat button on mobile */
    .new-chat-btn {
        margin: 25px 20px; /* More vertical margin */
        padding: 16px 20px; /* Larger padding */
        border-radius: 18px; /* Rounder corners */
        font-size: 16px; /* Larger font */
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.06); /* More prominent shadow */
    }
    
    /* Enhance user section */
    .user-section {
        padding: 22px; /* More padding */
        margin-bottom: 55px; /* Add bottom margin */
        border-top: 1px solid var(--border-color);
    }
    
    /* Make user icon larger */
    .user-section .user-icon {
        width: 48px; /* Larger user icon */
        height: 48px;
        font-size: 18px; /* Larger user initial */
    }
    
    /* Make the sidebar appear with a nice animation */
    .sidebar {
        transition: left 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
    }
    
    /* Make the overlay have a smoother fade */
    .overlay {
        transition: opacity 0.3s ease;
        opacity: 0;
    }
    
    .overlay.show {
        opacity: 1;
    }
}

        .new-chat-btn {
            margin: 20px;
            padding: 14px 18px;
            border: 1px solid var(--border-color);
            border-radius: var(--card-radius);
            background: var(--bg-color);
            color: var(--primary-color);
            font-size: 15px;
            font-weight: 500;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .new-chat-btn:hover {
            background: var(--bg-color);
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
            border-color: var(--border-hover);
        }

        .new-chat-btn svg {
            margin-right: 12px;
            color: var(--primary-color);
        }

        .history {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
        }

        .history-heading {
            font-family: Arial, sans-serif;
            font-size: 12px; /* Smaller font size */
            color: var(--text-light);
            margin: 12px 0 8px 8px;
            font-weight: 400; /* Lighter weight */
            letter-spacing: 0.3px; /* Reduced letter spacing */
            text-transform: uppercase;
        }

        .history-item {
            padding: 14px 18px;
            margin-bottom: 8px;
            border-radius: var(--card-radius);
            cursor: pointer;
            font-size: 14px;
            color: var(--primary-color) !important;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: var(--transition);
            display: flex;
            align-items: center;
            border: 1px solid transparent;
            background-color: transparent;
        }

        .history-item svg {
            margin-right: 12px;
            color: var(--primary-color);
        }

        .history-item:hover {
            background-color: var(--bg-color);
            border-color: var(--border-color);
            transform: translateX(2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

       /* Update user section styling for dark/light mode */
.user-section {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    margin-top: auto;
    background-color: var(--bg-color); /* Match background with theme */
    transition: var(--transition); /* Smooth transition when theme changes */
}

/* Update user icon to use an image instead of text */
.user-section .user-icon {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 14px;
    overflow: hidden; /* Keep the image within the circle */
    background-color: var(--bg-color); /* Use theme background */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

.user-section .user-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensure image covers the circle properly */
}

/* Adjust user info for dark mode */
.dark-mode .user-info .user-name {
    color: var(--text-color); /* Use theme text color */
}

.dark-mode .user-info .user-status {
    color: var(--text-light); /* Use theme light text color */
}

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .user-status {
            font-size: 13px;
            color: var(--text-light);
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 20;
            background-color: transparent;
            border: 0.1px solid transparent;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            
        }
        
        /* Mobile compose button */
        /* Mobile compose button */
.compose-toggle {
    display: none;
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 20;
    background-color: transparent; /* Changed from var(--primary-color) to transparent */
    border:  none; /* Added a subtle border */
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    
    color: var(--primary-color); /* Changed from white to text-color (black) */
    transition: var(--transition);
}

/* Add hover effect */
.compose-toggle:hover {
    background-color: rgb(5, 5, 5); /* Use the specified RGB color on hover */
    color: white; /* Change text color to white on hover for better contrast */
    transform: translateY(-2px); /* Add a subtle lift effect */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Enhanced shadow on hover */
}

        /* Main chat area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            height: 100%;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 0 20px;
            background: var(--bg-color); /* Changed from gradient to solid background color */
        }

        .welcome-screen img {
            height: 80px;
            margin-bottom: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .welcome-screen h1 {
            font-size: 38px;
            font-weight: 700;
            margin: 0 0 16px 0;
            color: var(--text-color);
            letter-spacing: -0.5px;
        }

        .welcome-screen p {
            font-size: 17px;
            color: var(--text-light);
            max-width: 600px;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            max-width: 1000px;
        }

        .suggestion {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--card-radius);
            padding: 22px 24px;
            width: 240px;
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .suggestion:hover {
            box-shadow: var(--card-shadow);
            border-color: var(--border-hover);
            transform: translateY(-3px);
        }

        .suggestion h3 {
            font-size: 16px;
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .suggestion p {
            font-size: 14px;
            color: var(--text-light);
            margin: 0;
            line-height: 1.5;
        }

        .message {
            padding: 24px 40px;
            margin: 0;
            display: flex;
            position: relative;
        }

        .user-message {
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
        }

        .bot-message {
            background-color: var(--message-bot-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            flex-shrink: 0;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.07);
            font-weight: 600;
            font-size: 16px;
        }

        .user-avatar {
            background-color: #EBF8FF; /* Keep this as a fixed color */
            color: var(--primary-color); /* Use variable for the text color */
        }
        
        .bot-avatar {
            background-color: var(--primary-color); /* Use variable for background */
            color: white; /* Keep this fixed for proper contrast */
        }

        .message-content {
            flex: 1;
            line-height: 1.7;
            font-size: 15px;
        }

        .input-container {
            border: 1.5px solid var(--primary-color);
            border-radius: var(--card-radius);
            background: var(--bg-color);
            display: flex;
            align-items: flex-end;
            transition: var(--transition);
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            max-width: 800px; /* Add max-width to limit the width */
            margin: 0 auto; /* Center the container */
            width: 90%; /* Make it responsive but not full width */
        }
        
        .input-area {
            padding: 24px 40px 32px;
            position: relative;
            bottom: 55px;
            border-top: none; /* Remove the border line */
            background: var(--bg-color);
            text-align: center; /* Center the disclaimer text */
        }

        .input-container:focus-within {
            box-shadow: var(--card-shadow);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .message-input {
            flex: 1;
            min-height: 24px;
            max-height: 200px;
            padding: 18px;
            border: none;
            resize: none;
            outline: none;
            font-size: 15px;
            line-height: 1.6;
            font-family: inherit;
            color: var(--text-color);
            overflow-y: auto;
            border-radius: var(--card-radius);
            background-color: transparent;
        }

        .message-input::placeholder {
            color: var(--text-light);
        }

        .send-button {
            padding: 14px 18px;
            margin: 17px;
            background: transparent; /* Changed from var(--primary-color) to transparent */
            border: none;
            border-radius: 14px;
            cursor: pointer;
            color: var(--primary-color); /* Changed from white to text-color (black) */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .send-button:hover {
            background: rgb(5, 5, 5); /* Changed to the specified dark color */
            color: white; /* Change text/icon color to white for better contrast with dark background */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); /* Reduced shadow opacity */
        }

        .disclaimer {
            font-size: 12px;
            color: var(--text-light);
            text-align: center;
            margin-top: 16px;
            max-width: 800px; /* Match the input container width */
            margin-left: auto;
            margin-right: auto;
        }

        .crypto-data {
            background: var(--message-bot-bg);
            border-radius: var(--card-radius);
            padding: 22px;
            margin-top: 16px;
            border-left: 3px solid var(--primary-color);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.04);
        }

        .crypto-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .crypto-header img {
            width: 36px;
            height: 36px;
            margin-right: 16px;
            border-radius: 50%;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .crypto-title {
            font-weight: 600;
            color: var(--text-color);
            font-size: 18px;
        }

        .crypto-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .crypto-detail {
            background: var(--bg-color);
            padding: 16px;
            border-radius: 14px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            transition: var(--transition);
        }
        
        .crypto-detail:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-color: var(--border-hover);
        }

        .detail-label {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }

        .market-data {
            background: var(--message-bot-bg);
            border-radius: var(--card-radius);
            padding: 22px;
            margin-top: 16px;
            border-left: 3px solid var(--primary-color);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.04);
        }

        .market-header {
            font-weight: 600;
            color: var(--text-color);
            font-size: 18px;
            margin-bottom: 16px;
        }

        .market-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .value-change {
            margin-left: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        .positive {
            color: #38A169;
        }

        .negative {
            color: #E53E3E;
        }

        /* Error message */
        .error-message {
            background-color: #FFF5F5;
            border-left: 3px solid #E53E3E;
            padding: 16px;
            border-radius: var(--card-radius);
            margin-top: 16px;
        }

        /* Coin search suggestion */
        .coin-search {
            margin-top: 18px;
            padding: 18px;
            background: #EBF8FF;
            border-radius: var(--card-radius);
            border-left: 3px solid var(--primary-color);
        }
        
        .coin-search-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .coin-examples {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.6;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #CBD5E0;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #A0AEC0;
        }

        /* Typing indicator animation */
        .typing-dots {
            display: inline-flex;
            align-items: center;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: var(--text-light);
            border-radius: 50%;
            opacity: 0.6;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            30% {
                transform: translateY(-4px);
                opacity: 1;
            }
        }

        /* Mobile responsive design */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                left: -300px;
                height: 100%;
                width: 300px;
                transition: left 0.3s ease;
            }

            .sidebar.show {
                left: 0;
            }
            
            .new-chat-btn {
                display: none; /* Hide the new conversation button on mobile */
            }
            
            .compose-toggle {
                display: flex; /* Show the compose button on mobile */
            }

            .chat-container {
                width: 100%;
            }

            .message {
                padding: 20px;
            }

            .input-area {
                padding: 16px 20px 20px;
            }

            .menu-toggle {
                display: flex;
            }

            /* Add dark mode styling for menu toggle and compose toggle */
.dark-mode .menu-toggle svg path,
.dark-mode .compose-toggle svg path {
    stroke: white; /* Make the lines white in dark mode */
}

/* Fix other dark mode colors */
.dark-mode ::-webkit-scrollbar-thumb {
    background: #555; /* Darker scrollbar in dark mode */
}

.dark-mode .suggestion {
    background: #111111;
    border-color: #333333;
}

.dark-mode .welcome-screen img {
    box-shadow: 0 8px 20px rgba(255, 255, 255, 0.1); /* White glow for logo in dark mode */
}

            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 5;
            }

            .overlay.show {
                display: block;
            }

            .suggestions {
                flex-direction: column;
                max-width: 100%;
            }

            .suggestion {
                width: 100%;
            }

            .crypto-details, 
            .market-details {
                grid-template-columns: 1fr;
            }
        }


        .history-item {
            position: relative; /* Ensure position is relative for absolute positioning of menu */
            padding: 14px 18px;
            margin-bottom: 8px;
            border-radius: var(--card-radius);
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            white-space: nowrap;
            overflow: visible; /* Change from hidden to visible to show dropdown */
            text-overflow: ellipsis;
            transition: var(--transition);
            display: flex;
            align-items: center;
            border: 1px solid transparent;
            background-color: transparent;
        }
        
        .history-item-menu {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            z-index: 5;
        }
        
        .history-item:hover .history-item-menu {
            opacity: 1;
        }

.history-item-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.history-item-dropdown {
    position: absolute;
    right: 0;
    top: 38px;
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    z-index: 100; /* Increase z-index to ensure it's above other elements */
    display: none;
    /* Add these properties to ensure it appears fully */
    min-width: 120px;
    margin-right: 10px; /* Add margin to ensure it's not at the edge */
}

.history-item-dropdown.show {
    display: block;
}

.dropdown-item {
    padding: 10px 15px; /* Increase padding for better touch targets */
    cursor: pointer;
    color: var(--text-color);
    font-size: 14px;
    white-space: nowrap;
    transition: var(--transition);
    text-align: left;
    width: 100%;
}

.dropdown-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
}


.rename-input {
    position: absolute;
    left: 40px; /* Align with the beginning of the text */
    right: 40px; /* Leave space on the right */
    padding: 6px 8px;
    border: 1px solid var(--border-hover);
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    background: var(--bg-color);
    z-index: 5;
}
/* Add styles for the conversation title header */
.conversation-title {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 20px;
    font-size: 16px;
    font-weight: 600;
    background-color: transparent;
    z-index: 5;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60%;
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
}

/* Style adjustments for mobile */
@media (max-width: 768px) {
    .conversation-title {
        top: 10px;
        padding: 10px 15px;
        font-size: 14px;
        max-width: 70%;
    }
    
    /* Add additional top padding to chat messages to make room for the title */
    .chat-messages {
        padding-top: 50px;
    }
}

/* Separate media query specifically for hiding suggestion boxes on mobile */
@media (max-width: 768px) {
    /* Hide the suggestion boxes on mobile */
    .suggestions {
        display: none;
    }
    
    /* Adjust welcome screen spacing when suggestions are hidden */
    .welcome-screen h1 {
        margin-bottom: 20px;
    }
    
    .welcome-screen p {
        margin-bottom: 10px;
    }
    
    /* Add a simple message in place of suggestions */
    .welcome-screen:after {
        
        font-size: 14px;
        color: var(--text-light);
        margin-top: 30px;
        display: block;
    }
}

/* Add this to your existing CSS */
.theme-toggle {
    background: transparent !important; ;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    color: var(--primary-color);
    transition: var(--transition);
}

.theme-toggle:hover {
    background-color: transparent;
    transform: scale(1.1);
}

.theme-toggle .sun-icon {
    display: none;
}

.dark-mode .theme-toggle .moon-icon {
    display: none;
}

.dark-mode .theme-toggle .sun-icon {
    display: block;
}

.dark-mode .theme-toggle:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Dark mode specific adjustments */
.dark-mode .bot-avatar {
    background-color: #FFFFFF; /* White instead of primary color */
    color: #000000;           /* Black text */
}
.dark-mode .user-avatar {
    background-color: #333333; /* Dark gray instead of light blue */
    color: #FFFFFF;           /* White text */
}

.dark-mode .crypto-data,
.dark-mode .market-data {
    border-left-color: #FFFFFF; /* White instead of blue */
}

.dark-mode .crypto-detail,
.dark-mode .message-input {
    background-color: rgba(0, 0, 0, 0.2);
}

.dark-mode .positive {
    color: #48BB78;
}

.dark-mode .negative {
    color: #F56565;
}

/* Theme toggle positioning for larger screens */
@media (min-width: 769px) {
    .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 15;
        background-color: transparent;
        border: none !important;
        width: 40px;
        height: 40px;
        box-shadow: none !important;
    }
    
    /* Remove from sidebar when it's in the corner */
    .user-section .theme-toggle {
        display: none;
    }
}

/* Hide theme toggle on mobile */

/* Remove the standalone theme toggle that appears outside the sidebar */
@media (min-width: 769px), (max-width: 768px) {
    /* Hide the standalone theme toggle in all media queries */
    .theme-toggle:not(.user-section .theme-toggle) {
        display: none;
    }
}

/* Style the theme toggle inside the user section */
.user-section .theme-toggle {
    display: flex;
    position: static; /* Override the fixed positioning */
    margin-left: auto; /* Push it to the right of the user info */
    width: 40px;
    height: 40px;
    background-color: transparent;
    border: none;
    box-shadow: none;
}

/* Make sure it's displayed in the user section */
.user-section {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    margin-top: auto;
}

/* Update user section styling for dark/light mode */
.user-section {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    margin-top: auto;
    background-color: var(--bg-color); /* Match background with theme */
    transition: var(--transition); /* Smooth transition when theme changes */
}

/* Update user icon to use an image instead of text */
.user-section .user-icon {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 14px;
    overflow: hidden; /* Keep the image within the circle */
    background-color: var(--bg-color); /* Use theme background */
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow */
}

.user-section .user-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Ensure image covers the circle properly */
}

/* Adjust user info for dark mode */
.dark-mode .user-info .user-name {
    color: var(--text-color); /* Use theme text color */
}

.dark-mode .user-info .user-status {
    color: var(--text-light); /* Use theme light text color */
}
/* Style the home button - place it next to the conversation title */
.home-button {
   /* Position it to the left of the conversation title */
    z-index: 10;
    background-color: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    color: var(--primary-color);
    transition: var(--transition);
}

.home-button svg {
    stroke: var(--text-color);
    stroke-width: 1.8;
}

.home-button:hover {
    transform: translateY(-2px);
}

/* Show the home button only when sidebar is hidden */
body.sidebar-hidden .home-button {
    display: flex;
}

@media (max-width: 768px) {
    .home-button {
        top: 10px;
        left: 60px; /* Position it next to the menu toggle */
    }
}
/* Ensure mobile viewport constraints with !important */
@media (max-width: 768px) {
    /* Fix input area stretching */
    .input-area {
        padding: 16px 15px 20px !important;
        width: 100% !important;
        box-sizing: border-box !important;
        overflow-x: hidden !important;
    }
    
    /* Fix input container width */
    .input-container {
        width: 100% !important;
        max-width: none !important;
        margin: 0 !important;
    }
    
    /* Fix message padding */
    .message {
        padding: 20px 15px !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* Ensure message content doesn't overflow */
    .message-content {
        max-width: 100% !important;
        overflow-wrap: break-word !important;
        word-wrap: break-word !important;
    }
    
    /* Fix crypto data cards */
    .crypto-data,
    .market-data {
        padding: 18px 15px !important;
        width: auto !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        overflow-x: hidden !important;
    }
    
    /* Fix crypto details grid */
    .crypto-details, 
    .market-details {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
        width: 100% !important;
    }
    
    /* Fix crypto detail cards */
    .crypto-detail {
        box-sizing: border-box !important;
        width: 100% !important;
        padding: 14px !important;
    }
    
    /* Fix disclaimer text */
    .disclaimer {
        width: 100% !important;
        padding: 0 5px !important;
        box-sizing: border-box !important;
    }
    
    /* Force body to full width */
    body {
        width: 100vw !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
    }
    
    /* Ensure main container doesn't overflow */
    .chat-container {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
    }
    
    /* Ensure chat messages area doesn't overflow */
    .chat-messages {
        width: 100% !important;
        box-sizing: border-box !important;
        overflow-x: hidden !important;
    }
}
/* Bottom Navigation */
.bottom-navigation {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 55px;
    background-color: var(--text-color);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    display: none;
    justify-content: space-around;
    align-items: center;
    padding: 0 10px;
    box-sizing: border-box;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    transition: background-color 0.3s ease;
}

body.dark-mode .bottom-navigation {
    background-color: rgba(0, 0, 0, 0.95);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.3);
}

/* Bottom Navigation Items */
.bottom-navigation .nav-item {
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: rgba(0, 0, 0, 0.8);
    transition: color 0.3s ease, transform 0.3s ease;
    flex: 1;
    height: 100%;
}

body.dark-mode .bottom-navigation .nav-item {
    color: rgba(255, 255, 255, 0.9);
}

.bottom-navigation .nav-item:hover {

    transform: scale(1.1);
}



/* Bottom Navigation Icons */
.bottom-navigation .material-symbols-outlined {
    font-size: 27px;
    transition: color 0.3s ease;
}


/* Zenus Icon */
.bottom-navigation .zenus-icon {
    width: 28px;
    height: 22px;
    object-fit: contain;
    transition: transform 0.3s ease;
}

.bottom-navigation .nav-item:hover .zenus-icon {
    transform: scale(1.2);
}

/* Navigation labels */
.bottom-navigation .nav-label {
    font-size: 10px;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.8);
    transition: color 0.3s ease;
    margin-top: 2px;
}

body.dark-mode .bottom-navigation .nav-label {
    color: rgba(255, 255, 255, 0.8);
}

/* Show the bottom navigation bar only on screens ≤ 768px */
@media (max-width: 768px) {
    .bottom-navigation {
        display: flex;
    }
}

/* Hide the bottom navigation bar on screens > 768px */
@media (min-width: 769px) {
    .bottom-navigation {
        display: none;
    }
}



    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Mobile menu toggle -->
    <button class="menu-toggle" id="menu-toggle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 7H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 12H18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 17H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
    
    <!-- Mobile compose button -->
    <button class="compose-toggle" id="compose-toggle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="white"/>
        </svg>
    </button>
    
    <!-- Mobile overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Remove the logo div entirely -->
        <button class="new-chat-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>New conversation</span>
        </button>
        
        <div class="history">
            <div class="history-heading">Recent</div>
            <div class="history-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                    <path d="M16 12H12V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Bitcoin market analysis</span>
            </div>
            <div class="history-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 9.5V5C2 3.89543 2.89543 3 4 3H20C21.1046 3 22 3.89543 22 5V9.5M2 9.5V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9.5M2 9.5H22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 7L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 15L16 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M8 15H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M8 7H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>Crypto market overview</span>
            </div>
            <div class="history-item">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 8L16 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M8 16L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 4v16M4 12h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span>Understanding DeFi</span>
            </div>
        </div>
        <!-- Update the user-section div like this -->
<!-- Update the user-section div to use an image -->
<div class="user-section">
    <div class="user-icon">
        <img src="user.png" alt="User" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 120 120\'><rect width=\'120\' height=\'120\' rx=\'60\' fill=\'%23EBF8FF\'/><text x=\'50%\' y=\'50%\' font-family=\'Arial\' font-size=\'60\' font-weight=\'bold\' text-anchor=\'middle\' dominant-baseline=\'middle\' fill=\'%233182CE\'>U</text></svg>'">
    </div>
    <div class="user-info">
        <div class="user-name">Jimmy</div>
    </div>
    <button class="theme-toggle" id="theme-toggle" title="Toggle dark/light mode">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="moon-icon">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="sun-icon">
            <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </button>
    <button class="home-button" id="home-button" title="Return to welcome screen">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 22V12h6v10" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
</div>
        <!-- Add this right after the theme-toggle button -->
<button class="sidebar-toggle-large" id="sidebar-toggle-large" title="Toggle sidebar">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="9" y1="3" x2="9" y2="21"></line>
    </svg>
</button>
    </div>
    

    <!-- Main chat area -->

   <!-- Replace the duplicate chat-container divs with this single one -->
<div class="chat-container">
    <div class="conversation-title" id="conversation-title">New conversation</div>
    <div class="chat-messages" id="chat-messages">
        <!-- Welcome screen (shown initially) -->
        <div class="welcome-screen" id="welcome-screen">
            <img src="zenus.png" alt="Zenus Logo" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 120 120\'><rect width=\'120\' height=\'120\' rx=\'24\' fill=\'%233182CE\'/><text x=\'50%\' y=\'50%\' font-family=\'Arial\' font-size=\'60\' font-weight=\'bold\' text-anchor=\'middle\' dominant-baseline=\'middle\' fill=\'white\'>Z</text></svg>'">
            <h1>Welcome to Zenus</h1>
            <p>Your cryptocurrency assistant with accurate market data</p>
            <div class="suggestions">
                <div class="suggestion">
                    <h3>Price Information</h3>
                    <p>What is the current price of Bitcoin?</p>
                </div>
                <div class="suggestion">
                    <h3>Market Overview</h3>
                    <p>Show me the current crypto market cap</p>
                </div>
                <div class="suggestion">
                    <h3>Alternative Coins</h3>
                    <p>What is the price of Chainlink?</p>
                </div>
                <div class="suggestion">
                    <h3>Trading Volume</h3>
                    <p>What's the 24h trading volume for Avalanche?</p>
                </div>
            </div>
        </div>
        
        
        <!-- Messages will be added here by JavaScript -->
    </div>
    <!-- Bottom Navigation Bar -->
<nav class="bottom-navigation">
    <a href="#home" class="nav-item">
        <span class="material-symbols-outlined">home</span>
        <span class="nav-label"></span>
    </a>
    <a href="ai.html" class="nav-item">
        <span class="nav-icon">
            <img src="zenus.png" alt="Zenus" class="zenus-icon">
        </span>
        <span class="nav-label"></span>
    </a>
    <a href="#charts" class="nav-item">
        <span class="material-symbols-outlined">monitoring</span>
        <span class="nav-label"></span>
    </a>
    <a href="wallet.html" class="nav-item">
        <span class="material-symbols-outlined">wallet</span>
        <span class="nav-label"></span>
    </a>
    <a href="#profile" class="nav-item">
        <span class="material-symbols-outlined">person</span>
        <span class="nav-label"></span>
    </a>
</nav>

<div class="input-area">
    <div class="input-container">
        <textarea class="message-input" placeholder="Ask about crypto" id="message-input"></textarea>
        <button class="send-button" id="send-button">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 2L15 22L10 14L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
        </button>
    </div>
</div>


    
</div>


    <script>

        // Add this to your existing DOMContentLoaded event handler
        const homeButton = document.getElementById('home-button');

        homeButton.addEventListener('click', function() {
            window.location.href = 'riki.html';
        });
        

        // Add this to your existing DOMContentLoaded event handler
const sidebarToggleLarge = document.getElementById('sidebar-toggle-large');

// Check if sidebar was previously hidden
const sidebarHidden = localStorage.getItem('sidebar-hidden') === 'true';
if (sidebarHidden) {
    document.body.classList.add('sidebar-hidden');
}

// Handle sidebar toggle click
sidebarToggleLarge.addEventListener('click', function() {
    // Toggle sidebar-hidden class on body
    document.body.classList.toggle('sidebar-hidden');
    
    // Save preference in localStorage
    localStorage.setItem('sidebar-hidden', document.body.classList.contains('sidebar-hidden'));
});

        // Add this to your existing DOMContentLoaded event handler
const themeToggle = document.getElementById('theme-toggle');

// Check for saved theme preference
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
    document.body.classList.add('dark-mode');
}

// Handle theme toggle click
themeToggle.addEventListener('click', function() {
    // Toggle dark-mode class on body
    document.body.classList.toggle('dark-mode');
    
    // Save preference in localStorage
    if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark');
    } else {
        localStorage.setItem('theme', 'light');
    }
});
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const chatMessages = document.getElementById('chat-messages');
            const welcomeScreen = document.getElementById('welcome-screen');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const composeToggle = document.getElementById('compose-toggle');
            
            // Flag to determine if we should use API or local responses
            let useLocalResponses = false;
            
            // Mobile menu toggle
            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('show');
            });
            
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
            });
            
            // Mobile compose button functionality
            composeToggle.addEventListener('click', function() {
                // Clear chat and show welcome screen
                const messages = document.querySelectorAll('.message');
                messages.forEach(msg => msg.remove());
                welcomeScreen.style.display = 'flex';
            });
            
            // Handle input height adjustment
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Handle enter key to send message
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Handle send button click
            sendButton.addEventListener('click', sendMessage);

            // Handle suggestions
            document.querySelectorAll('.suggestion').forEach(suggestion => {
                suggestion.addEventListener('click', function() {
                    const text = this.querySelector('p').textContent;
                    messageInput.value = text;
                    sendMessage();
                });
            });

            // Handle new chat button - update to work with both desktop and mobile buttons
            // Handle new chat button - update to work with both desktop and mobile buttons
document.querySelector('.new-chat-btn').addEventListener('click', function() {
    // Create a new conversation (this will clear the current chat area)
    createNewConversation();
    
    // On mobile, close sidebar
    sidebar.classList.remove('show');
    overlay.classList.remove('show');
});

// Also update the mobile compose button to create a new conversation
composeToggle.addEventListener('click', function() {
    // Create a new conversation
    createNewConversation();
    
    // On mobile, close sidebar
    sidebar.classList.remove('show');
    overlay.classList.remove('show');
});

            // Fetch crypto price data from CoinGecko
            async function fetchCryptoData(coin) {
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/coins/${coin}?localization=false&tickers=false&market_data=true&community_data=false&developer_data=false`);
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return {
                        name: data.name,
                        symbol: data.symbol.toUpperCase(),
                        price: data.market_data.current_price.usd,
                        priceChange24h: data.market_data.price_change_percentage_24h,
                        marketCap: data.market_data.market_cap.usd,
                        marketCapRank: data.market_cap_rank,
                        volume24h: data.market_data.total_volume.usd,
                        high24h: data.market_data.high_24h.usd,
                        low24h: data.market_data.low_24h.usd,
                        circulatingSupply: data.market_data.circulating_supply,
                        image: data.image.small
                    };
                } catch (error) {
                    console.error('Error fetching crypto data:', error);
                    useLocalResponses = true; // Switch to local responses if API fails
                    return null;
                }
            }

            // Fetch global market data from CoinGecko
            async function fetchGlobalMarketData() {
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/global');
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return {
                        totalMarketCap: data.data.total_market_cap.usd,
                        totalVolume: data.data.total_volume.usd,
                        marketCapPercentage: data.data.market_cap_percentage,
                        marketCapChange: data.data.market_cap_change_percentage_24h_usd,
                        activeCryptocurrencies: data.data.active_cryptocurrencies,
                        markets: data.data.markets
                    };
                } catch (error) {
                    console.error('Error fetching global market data:', error);
                    useLocalResponses = true; // Switch to local responses if API fails
                    return null;
                }
            }
            
            // Search for coin ID based on user input
            function findCoinId(message) {
                // If we find an exact match in our dictionary
                const words = message.toLowerCase().split(/\s+/);
                
                // First try multi-word coin names (like "bitcoin cash")
                for (let i = 0; i < words.length - 1; i++) {
                    const twoWordCoin = words[i] + ' ' + words[i+1];
                    if (topCoins[twoWordCoin]) {
                        return topCoins[twoWordCoin];
                    }
                    
                    // Try three word coins (like "basic attention token")
                    if (i < words.length - 2) {
                        const threeWordCoin = words[i] + ' ' + words[i+1] + ' ' + words[i+2];
                        if (topCoins[threeWordCoin]) {
                            return topCoins[threeWordCoin];
                        }
                    }
                }
                
                // Then try single words (like "bitcoin" or symbols like "btc")
                for (const word of words) {
                    if (topCoins[word]) {
                        return topCoins[word];
                    }
                }
                
                // If no match found
                return null;
            }

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (message.length === 0) return;
                
                // Check if we need to create a new conversation
                if (!currentConversationId) {
                    createNewConversation(message);
                } else {
                    // Add user message to current conversation and display
                    addMessageToCurrentConversation(message, 'user');
                    addMessage(message, 'user');
                }
                
                // Hide welcome screen
                welcomeScreen.style.display = 'none';
                
                // Clear input
                messageInput.value = '';
                messageInput.style.height = 'auto';
                
                // Show typing indicator
                const typingId = showTypingIndicator();
                
                // Check if we should use local responses
                if (useLocalResponses) {
                    // Add a delay to simulate thinking
                    setTimeout(() => {
                        hideTypingIndicator(typingId);
                        
                        // Get response from ai-answers.js
                        const response = getAIResponse(message);
                        addMessage(response, 'bot');
                        addMessageToCurrentConversation(response, 'bot');
                    }, 1000);
                    return;
                }
                
                // If not using local responses, try the API
                try {
                    // Check what kind of information user is requesting
                    const isPriceQuery = /(?:price|worth|value|cost|how much|trading at)/i.test(message);
                    const isMarketCapQuery = /(?:market ?cap|capitalization)/i.test(message);
                    const isVolumeQuery = /(?:volume|trading volume|24h volume)/i.test(message);
                    const isDominanceQuery = /(?:dominance|btc dominance|bitcoin dominance|market share)/i.test(message);
                    const isGlobalMarketQuery = /(?:global|overall|entire|total) (?:market|crypto|cryptocurrency)/i.test(message);
                    
                    // Extract the coin name using our expanded database
                    const coinId = findCoinId(message);
                    
                    // If it's a typical crypto data query, try the API
                    if (isPriceQuery || isMarketCapQuery || isVolumeQuery || isDominanceQuery || 
                        isGlobalMarketQuery || coinId) {
                        
                        // Handle different types of queries
                        if (isGlobalMarketQuery || (isMarketCapQuery && !coinId)) {
                            // Global market data query
                            const marketData = await fetchGlobalMarketData();
                            hideTypingIndicator(typingId);
                            
                            if (marketData) {
                                const btcDominance = marketData.marketCapPercentage.btc.toFixed(2);
                                const ethDominance = marketData.marketCapPercentage.eth.toFixed(2);
                                
                                const marketCapChangeClass = marketData.marketCapChange >= 0 ? 'positive' : 'negative';
                                const marketCapChangeSymbol = marketData.marketCapChange >= 0 ? '▲' : '▼';
                                
                                const responseHTML = `
                                    Here's the current global cryptocurrency market overview:
                                    
                                    <div class="market-data">
                                        <div class="market-header">Global Crypto Market</div>
                                        <div class="market-details">
                                            <div class="crypto-detail">
                                                <div class="detail-label">Total Market Cap</div>
                                                <div class="detail-value">
                                                    $${formatNumber(marketData.totalMarketCap)}
                                                    <span class="value-change ${marketCapChangeClass}">
                                                        ${marketCapChangeSymbol} ${Math.abs(marketData.marketCapChange).toFixed(2)}%
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">24h Trading Volume</div>
                                                <div class="detail-value">$${formatNumber(marketData.totalVolume)}</div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">BTC Dominance</div>
                                                <div class="detail-value">${btcDominance}%</div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">ETH Dominance</div>
                                                <div class="detail-value">${ethDominance}%</div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">Active Cryptocurrencies</div>
                                                <div class="detail-value">${marketData.activeCryptocurrencies.toLocaleString()}</div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">Active Markets</div>
                                                <div class="detail-value">${marketData.markets.toLocaleString()}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    This data is sourced from CoinGecko API and represents the current state of the cryptocurrency market. Is there anything specific about this data you'd like to know more about?
                                `;
                                
                                addMessageHTML(responseHTML, 'bot');
                                addMessageToCurrentConversation(responseHTML, 'bot', true);
                            } else {
                                // Fallback to local response if API fails
                                const response = getAIResponse(message);
                                addMessage(response, 'bot');
                                addMessageToCurrentConversation(response, 'bot');
                            }
                        } else if (isDominanceQuery) {
                            // BTC dominance query
                            const marketData = await fetchGlobalMarketData();
                            hideTypingIndicator(typingId);
                            
                            if (marketData) {
                                const btcDominance = marketData.marketCapPercentage.btc.toFixed(2);
                                const ethDominance = marketData.marketCapPercentage.eth.toFixed(2);
                                
                                const responseHTML = `
                                    Here's the current cryptocurrency market dominance:
                                    
                                    <div class="market-data">
                                        <div class="market-header">Market Dominance</div>
                                        <div class="market-details">
                                            <div class="crypto-detail">
                                                <div class="detail-label">Bitcoin (BTC) Dominance</div>
                                                <div class="detail-value">${btcDominance}%</div>
                                            </div>
                                            <div class="crypto-detail">
                                                <div class="detail-label">Ethereum (ETH) Dominance</div>
                                                <div class="detail-value">${ethDominance}%</div>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    Bitcoin currently represents ${btcDominance}% of the total cryptocurrency market capitalization. This metric shows Bitcoin's market value relative to the entire crypto market and is an important indicator of market sentiment and Bitcoin's influence on the overall market.
                                `;
                                
                                addMessageHTML(responseHTML, 'bot');
                                addMessageToCurrentConversation(responseHTML, 'bot', true);
                            } else {
                                // Fallback to local response if API fails
                                const response = getAIResponse(message);
                                addMessage(response, 'bot');
                                addMessageToCurrentConversation(response, 'bot');
                            }
                        } else if (coinId) {
                            // Specific coin query
                            const cryptoData = await fetchCryptoData(coinId);
                            hideTypingIndicator(typingId);
                            
                            if (cryptoData) {
                                const priceChangeClass = cryptoData.priceChange24h >= 0 ? 'positive' : 'negative';
                                const priceChangeSymbol = cryptoData.priceChange24h >= 0 ? '▲' : '▼';
                                
                                // Determine what specific data to highlight based on query type
                                let responseHTML;
                                
                                if (isPriceQuery) {
                                    responseHTML = `
                                        The current price of ${cryptoData.name} (${cryptoData.symbol}) is:
                                        
                                        <div class="crypto-data">
                                            <div class="crypto-header">
                                                <img src="${cryptoData.image}" alt="${cryptoData.name}">
                                                <span class="crypto-title">${cryptoData.name}</span>
                                            </div>
                                            <div class="crypto-details">
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Current Price</div>
                                                    <div class="detail-value">
                                                        $${cryptoData.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: cryptoData.price < 1 ? 6 : 2})}
                                                        <span class="value-change ${priceChangeClass}">
                                                            ${priceChangeSymbol} ${Math.abs(cryptoData.priceChange24h).toFixed(2)}%
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">24h High</div>
                                                    <div class="detail-value">$${cryptoData.high24h.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: cryptoData.high24h < 1 ? 6 : 2})}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">24h Low</div>
                                                    <div class="detail-value">$${cryptoData.low24h.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: cryptoData.low24h < 1 ? 6 : 2})}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                } else if (isMarketCapQuery) {
                                    // Market cap query implementation
                                    responseHTML = `
                                        Here's the market capitalization data for ${cryptoData.name} (${cryptoData.symbol}):
                                        
                                        <div class="crypto-data">
                                            <div class="crypto-header">
                                                <img src="${cryptoData.image}" alt="${cryptoData.name}">
                                                <span class="crypto-title">${cryptoData.name}</span>
                                            </div>
                                            <div class="crypto-details">
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Market Cap</div>
                                                    <div class="detail-value">$${formatNumber(cryptoData.marketCap)}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Market Cap Rank</div>
                                                    <div class="detail-value">#${cryptoData.marketCapRank}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Circulating Supply</div>
                                                    <div class="detail-value">${formatNumber(cryptoData.circulatingSupply)} ${cryptoData.symbol}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                } else if (isVolumeQuery) {
                                    // Volume query implementation
                                    responseHTML = `
                                        Here's the trading volume data for ${cryptoData.name} (${cryptoData.symbol}):
                                        
                                        <div class="crypto-data">
                                            <div class="crypto-header">
                                                <img src="${cryptoData.image}" alt="${cryptoData.name}">
                                                <span class="crypto-title">${cryptoData.name}</span>
                                            </div>
                                            <div class="crypto-details">
                                                <div class="crypto-detail">
                                                    <div class="detail-label">24h Trading Volume</div>
                                                    <div class="detail-value">$${formatNumber(cryptoData.volume24h)}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Volume/Market Cap</div>
                                                    <div class="detail-value">${(cryptoData.volume24h / cryptoData.marketCap * 100).toFixed(2)}%</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Current Price</div>
                                                    <div class="detail-value">
                                                        $${cryptoData.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: cryptoData.price < 1 ? 6 : 2})}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    // General coin information
                                    responseHTML = `
                                        Here's the current data for ${cryptoData.name} (${cryptoData.symbol}):
                                        
                                        <div class="crypto-data">
                                            <div class="crypto-header">
                                                <img src="${cryptoData.image}" alt="${cryptoData.name}">
                                                <span class="crypto-title">${cryptoData.name}</span>
                                            </div>
                                            <div class="crypto-details">
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Current Price</div>
                                                    <div class="detail-value">
                                                        $${cryptoData.price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: cryptoData.price < 1 ? 6 : 2})}
                                                        <span class="value-change ${priceChangeClass}">
                                                            ${priceChangeSymbol} ${Math.abs(cryptoData.priceChange24h).toFixed(2)}%
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Market Cap</div>
                                                    <div class="detail-value">$${formatNumber(cryptoData.marketCap)}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Market Cap Rank</div>
                                                    <div class="detail-value">#${cryptoData.marketCapRank}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">24h Trading Volume</div>
                                                    <div class="detail-value">$${formatNumber(cryptoData.volume24h)}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">24h High / Low</div>
                                                    <div class="detail-value">$${cryptoData.high24h.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} / $${cryptoData.low24h.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                                </div>
                                                <div class="crypto-detail">
                                                    <div class="detail-label">Circulating Supply</div>
                                                    <div class="detail-value">${formatNumber(cryptoData.circulatingSupply)} ${cryptoData.symbol}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                        This data is sourced from CoinGecko API and represents the current market conditions for ${cryptoData.name}.
                                    `;
                                }
                                
                                addMessageHTML(responseHTML, 'bot');
                                addMessageToCurrentConversation(responseHTML, 'bot', true);
                            } else {
                                // Fallback to local response if API fails
                                const response = getAIResponse(message);
                                addMessage(response, 'bot');
                                addMessageToCurrentConversation(response, 'bot');
                            }
                        } else {
                            // Generic crypto query without specific coin
                            hideTypingIndicator(typingId);
                            
                            // Use our ai-answers.js for a response
                            const response = getAIResponse(message);
                            addMessage(response, 'bot');
                            addMessageToCurrentConversation(response, 'bot');
                        }
                    } else {
                        // For non-crypto specific queries, use our ai-answers.js
                        hideTypingIndicator(typingId);
                        const response = getAIResponse(message);
                        addMessage(response, 'bot');
                        addMessageToCurrentConversation(response, 'bot');
                    }
                } catch (error) {
                    console.error('Error processing message:', error);
                    hideTypingIndicator(typingId);
                    
                    // Fallback to local response if anything goes wrong
                    const response = getAIResponse(message);
                    addMessage(response, 'bot');
                    addMessageToCurrentConversation(response, 'bot');
                    
                    // Set flag to use local responses going forward
                    useLocalResponses = true;
                }
            }
            
            // Helper function to format large numbers
            function formatNumber(num) {
                if (num >= 1e12) {
                    return (num / 1e12).toFixed(2) + ' T';
                } else if (num >= 1e9) {
                    return (num / 1e9).toFixed(2) + ' B';
                } else if (num >= 1e6) {
                    return (num / 1e6).toFixed(2) + ' M';
                } else if (num >= 1e3) {
                    return (num / 1e3).toFixed(2) + ' K';
                } else {
                    return num.toLocaleString('en-US', {maximumFractionDigits: 2});
                }
            }
            
            function showTypingIndicator() {
                const typingIndicator = document.createElement('div');
                typingIndicator.classList.add('message', 'bot-message');
                typingIndicator.id = 'typing-indicator-' + Date.now();
                
                const avatar = document.createElement('div');
                avatar.classList.add('avatar', 'bot-avatar');
                avatar.textContent = 'Z';
                
                const content = document.createElement('div');
                content.classList.add('message-content');
                
                const dotsContainer = document.createElement('div');
                dotsContainer.classList.add('typing-dots');
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('span');
                    dot.classList.add('typing-dot');
                    dotsContainer.appendChild(dot);
                }
                
                content.appendChild(document.createTextNode('Retrieving data '));
                content.appendChild(dotsContainer);
                
                typingIndicator.appendChild(avatar);
                typingIndicator.appendChild(content);
                chatMessages.appendChild(typingIndicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                return typingIndicator.id;
            }
            
            function hideTypingIndicator(id) {
                const indicator = document.getElementById(id);
                if (indicator) {
                    indicator.remove();
                }
            }
            
            function addMessage(content, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
                
                const avatar = document.createElement('div');
                avatar.classList.add('avatar');
                avatar.classList.add(sender === 'user' ? 'user-avatar' : 'bot-avatar');
                avatar.textContent = sender === 'user' ? 'U' : 'Z';
                
                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                messageContent.textContent = content;
                
                messageElement.appendChild(avatar);
                messageElement.appendChild(messageContent);
                
                chatMessages.appendChild(messageElement);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            function addMessageHTML(contentHTML, sender) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
                
                const avatar = document.createElement('div');
                avatar.classList.add('avatar');
                avatar.classList.add(sender === 'user' ? 'user-avatar' : 'bot-avatar');
                avatar.textContent = sender === 'user' ? 'U' : 'Z';
                
                const messageContent = document.createElement('div');
                messageContent.classList.add('message-content');
                messageContent.innerHTML = contentHTML;
                
                messageElement.appendChild(avatar);
                messageElement.appendChild(messageContent);
                
                chatMessages.appendChild(messageElement);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Create a data structure to store conversations
            let conversations = [];
            let currentConversationId = null;

            // Function to create a new conversation
            // Function to create a new conversation
            function createNewConversation(firstMessage = null) {
                // Clear current messages in the chat window
                const messages = document.querySelectorAll('.message');
                messages.forEach(msg => msg.remove());
                
                // Show welcome screen if no first message
                if (!firstMessage) {
                    welcomeScreen.style.display = 'flex';
                    // Set default title for new conversation
                    document.getElementById('conversation-title').textContent = 'New conversation';
                } else {
                    welcomeScreen.style.display = 'none';
                    // Set title based on first message
                    const title = firstMessage.length > 25 ? firstMessage.substring(0, 25) + '...' : firstMessage;
                    document.getElementById('conversation-title').textContent = title;
                }
    
    // Create new conversation object
    const conversationId = 'conv-' + Date.now();
    currentConversationId = conversationId;
    
    const newConversation = {
        id: conversationId,
        title: firstMessage ? (firstMessage.length > 25 ? firstMessage.substring(0, 25) + '...' : firstMessage) : 'New conversation',
        messages: []
    };
    
    // Add to the beginning of the array, but keep all previous conversations
    conversations.unshift(newConversation);
    
    // If we have a first message, add it to the new conversation
    if (firstMessage) {
        addMessageToCurrentConversation(firstMessage, 'user');
        addMessage(firstMessage, 'user');
    }
    
    // Update the sidebar with all conversations including the new one
    updateConversationHistory();
    
    return conversationId;
}

            // Function to add a message to the current conversation
            function addMessageToCurrentConversation(content, sender, isHTML = false) {
                if (!currentConversationId) {
                    createNewConversation(sender === 'user' ? content : null);
                }
                
                // Find the current conversation
                const conversation = conversations.find(conv => conv.id === currentConversationId);
                
                if (conversation) {
                    // Add message to the conversation
                    conversation.messages.push({
                        content: content,
                        sender: sender,
                        isHTML: isHTML,
                        timestamp: new Date().toISOString()
                    });
                    
                    // If this is the first user message, update the conversation title
                    if (sender === 'user' && conversation.messages.length === 1) {
                        conversation.title = content.length > 25 ? content.substring(0, 25) + '...' : content;
                        updateConversationHistory();
                    }
                }
            }

            // Function to display a conversation
            function displayConversation(conversationId) {
                // Clear current messages
                const messages = document.querySelectorAll('.message');
                messages.forEach(msg => msg.remove());
                
                // Hide welcome screen
                welcomeScreen.style.display = 'none';
                
                // Set current conversation
                currentConversationId = conversationId;
                
                // Find the conversation
                const conversation = conversations.find(conv => conv.id === conversationId);
                
                if (conversation) {
                    // Update the conversation title at the top
                    document.getElementById('conversation-title').textContent = conversation.title;
                    
                    // Display all messages
                    conversation.messages.forEach(msg => {
                        if (msg.isHTML) {
                            addMessageHTML(msg.content, msg.sender);
                        } else {
                            addMessage(msg.content, msg.sender);
                        }
                    });
                }
            }

            // Function to update the conversation history in the sidebar
            // Update the updateConversationHistory function

function updateConversationHistory() {
    // Get the history container
    const historyContainer = document.querySelector('.history');
    
    // Clear all history items except the heading
    const heading = document.querySelector('.history-heading');
    historyContainer.innerHTML = '';
    historyContainer.appendChild(heading);
    
    // Add each conversation as a history item
    conversations.forEach(conversation => {
        const historyItem = document.createElement('div');
        historyItem.classList.add('history-item');
        historyItem.dataset.id = conversation.id;
        
        // Add icon
        const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        icon.setAttribute('width', '18');
        icon.setAttribute('height', '18');
        icon.setAttribute('viewBox', '0 0 24 24');
        icon.setAttribute('fill', 'none');
        
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', 'M2 9.5V5C2 3.89543 2.89543 3 4 3H20C21.1046 3 22 3.89543 22 5V9.5M2 9.5V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9.5M2 9.5H22');
        path.setAttribute('stroke', 'currentColor');
        path.setAttribute('stroke-width', '2');
        path.setAttribute('stroke-linecap', 'round');
        
        icon.appendChild(path);
        
        // Add span with title
        const span = document.createElement('span');
        span.classList.add('history-item-title');
        span.textContent = conversation.title;
        
        // Add three dots menu
        const menuDots = document.createElement('div');
        menuDots.classList.add('history-item-menu');
        menuDots.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="6" r="2" fill="currentColor"/>
                <circle cx="12" cy="12" r="2" fill="currentColor"/>
                <circle cx="12" cy="18" r="2" fill="currentColor"/>
            </svg>
        `;
        
        // Add dropdown menu
        const dropdown = document.createElement('div');
        dropdown.classList.add('history-item-dropdown');
        
        const renameOption = document.createElement('div');
        renameOption.classList.add('dropdown-item');
        renameOption.textContent = 'Rename';
        
        dropdown.appendChild(renameOption);
        
        historyItem.appendChild(icon);
        historyItem.appendChild(span);
        historyItem.appendChild(menuDots);
        historyItem.appendChild(dropdown);
        
        // Add click event for the conversation item
        historyItem.addEventListener('click', function(e) {
            // If clicking on the menu dots or dropdown, don't navigate
            if (e.target.closest('.history-item-menu') || e.target.closest('.history-item-dropdown')) {
                return;
            }
            
            displayConversation(conversation.id);
            
            // On mobile, close sidebar
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
        });
        
        // Add click event for the menu dots
        menuDots.addEventListener('click', function(e) {
            e.stopPropagation();
            
            // Close all other dropdowns
            document.querySelectorAll('.history-item-dropdown.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                }
            });
            
            // Toggle this dropdown
            dropdown.classList.toggle('show');
        });
        
        // Add click event for rename option
        renameOption.addEventListener('click', function(e) {
            e.stopPropagation();
            
            // Close dropdown
            dropdown.classList.remove('show');
            
            // Create input for renaming
            const renameInput = document.createElement('input');
            renameInput.type = 'text';
            renameInput.classList.add('rename-input');
            renameInput.value = conversation.title;
            
            // Hide the title span
            span.style.display = 'none';
            
            // Add input to history item
            historyItem.appendChild(renameInput);
            
            // Focus and select all text
            renameInput.focus();
            renameInput.select();
            
            // Prevent double-click from propagating
            renameInput.addEventListener('dblclick', function(e) {
                e.stopPropagation();
            });
            
            // Prevent click from propagating
            renameInput.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Prevent mousedown from propagating (covers more cases)
            renameInput.addEventListener('mousedown', function(e) {
                e.stopPropagation();
            });
            
            // Handle enter key
            renameInput.addEventListener('keydown', function(e) {
                e.stopPropagation(); // Prevent keydown events from reaching parent elements
                
                if (e.key === 'Enter') {
                    finishRename();
                } else if (e.key === 'Escape') {
                    cancelRename();
                }
            });
            
            // Handle click outside
            const handleClickOutside = function(event) {
                // Don't finish rename if the event target is part of the input
                if (!renameInput.contains(event.target)) {
                    finishRename();
                    document.removeEventListener('click', handleClickOutside);
                }
            };
            
            // Add click outside listener with a small delay to avoid immediate trigger
            setTimeout(() => {
                document.addEventListener('click', handleClickOutside);
            }, 100);
            
            function finishRename() {
                const newTitle = renameInput.value.trim();
                if (newTitle) {
                    conversation.title = newTitle;
                    span.textContent = newTitle;
                    
                    // Also update the conversation title at the top if this is the current conversation
                    if (conversation.id === currentConversationId) {
                        document.getElementById('conversation-title').textContent = newTitle;
                    }
                }
                
                // Show title span again
                span.style.display = '';
                
                // Remove input
                if (renameInput.parentElement) {
                    renameInput.remove();
                }
                
                document.removeEventListener('click', handleClickOutside);
            }
            
            function cancelRename() {
                // Show title span again
                span.style.display = '';
                
                // Remove input
                if (renameInput.parentElement) {
                    renameInput.remove();
                }
                
                document.removeEventListener('click', handleClickOutside);
            }
        });
        
        // Add click event to document to close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.history-item-menu') && !e.target.closest('.history-item-dropdown')) {
                dropdown.classList.remove('show');
            }
        });
        
        historyContainer.appendChild(historyItem);
    });
}

            // Initialize a default conversation
            createNewConversation();
        });
    </script>
</body>
</html>
